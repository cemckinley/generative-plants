<!DOCTYPE html>

<html dir="ltr" lang="en">
<head>
	<meta charset="utf-8" />
	
	<title>Generative Plants test</title>
	
	<style type="text/css">
	
		#canvas{
			display:block;
			width:700px;
			height:900px;
			background:#000;
			margin:50px auto;
		}
		
	</style>
	
	<script type="text/javascript">
		
		function draw(){
			var canvas = document.getElementById('canvas'),
				ctx = canvas.getContext('2d'),
				cWidth = canvas.width,
				cHeight = canvas.height,
				avgSegments = 32,
				segmentVariability = 2, // max number possible + or - branch segments
				maxBranches = 3,
				startLineWidth = 14,
				startingBranchProbability = .6, // a decimal between 0-1 to indicate probability of another branch starting from the same point
				branchProbabilityReductionRate = .9, // how fast the probability reduces toward the end of a branch
				maxBerriesPerSegment = 4,
				berryWidth = 3;
			
			ctx.fillStyle = 'white';
			ctx.strokeStyle = 'white';
			ctx.lineJoin = 'round';
			ctx.lineCap = 'round';
			ctx.lineWidth = startLineWidth;
			ctx.translate(cWidth/2, cHeight);
			
			function branch(segments, branches, branchProbability, berryProbability, berrySize){
				var segmentVariation = randomNumberInRange(0, segmentVariability, true),
					segmentLength = randomNumberInRange(-130, -120, false);
				
				ctx.save();
				ctx.rotate(randomAngle(10, 27, true));
				ctx.beginPath();
				ctx.lineTo(0,0);
				ctx.lineTo(0,segmentLength);
				ctx.translate(0,segmentLength);
				ctx.stroke();
				
				// berries
				if(segments <= avgSegments/2){ // only add berries on upper half of branches
					ctx.beginPath();
					console.log(berrySize);
					ctx.arc(randomNumberInRange(startLineWidth,startLineWidth + 5,true), randomNumberInRange(segmentLength/2, segmentLength, false), berrySize, 0, 2*Math.PI, false);
					ctx.fill();
				}
				
				segments--;
				if(segments + segmentVariation > 0){ // recursively call next branch segment
					ctx.scale(.9,.9);
					branch(segments, maxBranches, branchProbability * branchProbabilityReductionRate, 2, berrySize*1.08); // next will branch randomly within maxBranch number of times. Berry size needs to incrementally increase to compensate for segment size shrink
				}
				
				ctx.restore();
				
				branches--;
				if(branches > 0 && Math.random() <= branchProbability){ // start another branch from last saved coordinate
					branch(segments, branches, branchProbability, 2, berrySize);
				}
				
				
			}
			branch(avgSegments, 0, startingBranchProbability, 2, berryWidth);
			
			// generate randomized number, where number is a number between $min and $max, and plusOrMinus is a boolean indicating if that number can be positive or negative
			function randomNumberInRange(min, max, plusOrMinus){
				var variation = Math.random() * (max - min),
					randomNumber = max - variation,
					posNeg = 1;
					
				if(plusOrMinus){
					posNeg = Math.random();
					posNeg <= .5 ? posNeg = 1 : posNeg = -1;
				}
				
				return Math.random() * (randomNumber * posNeg);
			}
			
			function randomAngle(min, max, plusOrMinus){ // canvas rotates using radians, so output result of randomNumberInRange in radians
				return Math.PI / (180 / randomNumberInRange(min, max, plusOrMinus)); 
			}
			
		}		
		
		window.onload = draw;
		
	</script>
	
</head>

<body>
	
	<canvas id="canvas" width="700" height="900">
	</canvas>
	
</body>

</html>